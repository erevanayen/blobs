<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<style>
    body {
        margin: 0;
    }
    canvas {
        width: 100vw;
        height: 100vh;
        display: block;
    }
</style>
<body>
    <canvas id="myCanvas"></canvas>
    <script type="module">
        import * as THREE from "https://cdn.jsdelivr.net/npm/three@v0.149.0/build/three.module.js"
        import { frame } from "https://cdn.jsdelivr.net/npm/motion@12.11.0/+esm"

        const fragmentShaderSource = `
#include <common>
precision mediump float;
uniform vec3 iResolution;
uniform float uTime, uAnimSpeed, uFOV;
float v(vec3 v,float m){return length(v)-m;}float v(float v,float f,float m){float u=max(m-abs(v-f),0.)/m;return min(v,f)-u*u*u*m*(1./6.);}mat2 v(float v){float f=sin(v);v=cos(v);return mat2(v,-f,f,v);}float v(vec3 m,float f,float s){vec3 u=vec3(sin(uTime/5.*f)*2.,sin(uTime/2.*f)*.5-.8,sin(uTime/3.*f)*1.5),a=vec3(sin(uTime/4.*f-3.14159)*2.,sin(uTime/1.5*f)*.5-.8,sin(uTime/2.*f-3.14159)*1.5);return v(m.y+.25,v(v(m-u,s),v(m-a,s),2.),4.);}float v(float f,float m){return f<.5?2.*f*m:1.-2.*(1.-f)*(1.-m);}vec4 v(vec4 f,vec4 m,float u){return vec4(v(f.x,m.x),v(f.y,m.y),v(f.z,m.z),f.w)*u+m*(1.-u);}vec3[4] m=vec3[](vec3(.286,.106,.051),vec3(.898,.549,.035),vec3(.98,.686,.2),vec3(.2)),f=vec3[](vec3(.98,.686,.2),vec3(.898,.549,.035),vec3(.286,.106,.051),vec3(.1)),s=vec3[](vec3(0,.255,.212),vec3(.008,.557,.498),vec3(.549,.773,.247),vec3(.2)),u=vec3[](vec3(.549,.773,.247),vec3(0,.255,.212),vec3(.008,.557,.498),vec3(.2));vec3 v(float v,vec3[4] f){float m=f[3].x;return mix(mix(f[0],f[1],v/m),mix(f[1],f[2],(v-m)/(1.-m)),step(m,v));}vec4 v(vec2 f,float m,vec3 u,float s,float a,vec3[4] x,float y){vec3 r=vec3(0,0,-s),i=normalize(vec3(f*uFOV,1)),V=vec3(0);s=0.;r.yz*=v(u.x);i.yz*=v(u.x);int g;for(g=0;g<120;g++){vec3 f=r+i*s;float u=v(f,a,m);s+=u;if(u<.001)break;if(s>1e2)break;}V=v(s*.04+float(g)*.005,x);return vec4(V,1);}void main(){vec2 f=(gl_FragCoord.xy*2.-iResolution.xy)/iResolution.y;vec4 m=v(f,1.,vec3(1,.6,0),2.2,uAnimSpeed,s,0.),a=v(f,1.3,vec3(1.2,.7,0),3.2,uAnimSpeed*-2.,u,10.);gl_FragColor=v(m,a,abs(sin(uTime/8.)));}
        `;

        const canvas = document.getElementById('myCanvas');
        const camera = new THREE.OrthographicCamera(
            -1, // left
            1, // right
            1, // top
            -1, // bottom
            -1, // near,
            1, // far
        );
        const renderer = new THREE.WebGLRenderer({
            antialias: true,
            canvas: canvas,
        });
        renderer.autoClearColor = false;

        // uniforms for the shader
        const uniforms = {
            uTime: { value: 0 },
            uAnimSpeed: { value: .2 },
            uFOV: { value: 0.5 },
            iResolution: { value: new THREE.Vector3() },
        };

        const scene = new THREE.Scene();
        const plane = new THREE.PlaneGeometry(2, 2);
        const material = new THREE.ShaderMaterial({
            fragmentShader: fragmentShaderSource,
            uniforms,
        });
        scene.add(new THREE.Mesh(plane, material));

        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        function resizeCanvas() {
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        window.addEventListener('resize', resizeCanvas);

        function updateFrame() {
            var time = performance.now();
            uniforms.uTime.value = time * 0.001; // set time to seconds
            uniforms.iResolution.value.set(canvas.width, canvas.height, 1);
            renderer.render(scene, camera);
        }
        frame.update(updateFrame, true);
    </script>
</body>
</html>